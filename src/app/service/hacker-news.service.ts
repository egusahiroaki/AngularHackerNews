import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';
import { JsonpModule } from '@angular/http/src/http_module';
import { Jsonp, URLSearchParams } from '@angular/http';

import 'rxjs/add/operator/map';
import 'rxjs/add/observable/throw';
import 'rxjs/add/operator/catch';

@Injectable()
export class HackerNewsService {
  // Top Stroriesを取得する
  constructor(
    private http: HttpClient,
    private jsonp: Jsonp,
  ) {}

  // user https://hacker-news.firebaseio.com/v0/item/126809.json?print=pretty
  getTopStories(): Observable<any> {
    const params =  new URLSearchParams();
    params.set('callback', 'JSONP_CALLBACK');
    return this.jsonp.get('https://hacker-news.firebaseio.com/v0/topstories.json',
      { search: params })
      .map(
        response => {
          console.log('response');
          return response.json() || {};
        }
      ).
    catch(error => {
      console.log('response error');
      console.log(error);
      return Observable.throw(error.statusTest);
    });
  }

  // 引数はstoryの数
  getEachStories(id: number) {
    const url = `https://hacker-news.firebaseio.com/v0/item/${id}.json?print=pretty`;
    return this.http.get(url);
  }
}

/*
[ 15696855, 15696596, 15694430, 15694926, 15695903, 15694641, 15696109, 15694018, 15695013, 15695114, 15695129, 15694118, 15695545, 15693499, 15695326, 15693916, 15693756, 15695457, 15693237, 15694087, 15694578, 15695196, 15694318, 15692688, 15692604, 15694266, 15693837, 15692896, 15682536, 15694972, 15692609, 15691435, 15690121, 15691409, 15690957, 15686442, 15694558, 15686653, 15686600, 15685454, 15691165, 15692350, 15694899, 15688900, 15693962, 15693906, 15695012, 15686875, 15690954, 15691956, 15689624, 15687800, 15692153, 15691899, 15691477, 15687005, 15691817, 15694985, 15689700, 15686316, 15693228, 15694372, 15692004, 15686350, 15693790, 15681379, 15688506, 15690382, 15692828, 15694153, 15686504, 15685180, 15686403, 15684785, 15687913, 15684372, 15691204, 15694610, 15681358, 15689399, 15688972, 15683836, 15688396, 15676737, 15683275, 15691154, 15687662, 15680668, 15680180, 15692716, 15686661, 15683267, 15686400, 15681755, 15678492, 15693071, 15684378, 15692458, 15691877, 15691885, 15689998, 15691021, 15692301, 15688806, 15688097, 15685541, 15691407, 15679599, 15690988, 15690943, 15685505, 15686794, 15690737, 15693764, 15689294, 15680005, 15676951, 15692579, 15681252, 15685324, 15675591, 15685307, 15692725, 15679150, 15693583, 15688570, 15692229, 15684139, 15692638, 15681431, 15689476, 15682376, 15685162, 15677727, 15680609, 15681545, 15692976, 15684898, 15684220, 15692456, 15680739, 15680430, 15693383, 15690190, 15676785, 15691771, 15676681, 15685814, 15693251, 15684225, 15690814, 15681566, 15689155, 15680368, 15681526, 15681351, 15693001, 15677206, 15687713, 15676371, 15676580, 15692929, 15686900, 15685680, 15692877, 15678175, 15688306, 15687217, 15680787, 15680623, 15679321, 15677560, 15685649, 15678841, 15696056, 15676307, 15685848, 15692559, 15678542, 15675439, 15681066, 15680591, 15679853, 15689605, 15685905, 15683658, 15675118, 15677299, 15691288, 15683120, 15680355, 15675695, 15692191, 15682774, 15675750, 15675582, 15678471, 15689511, 15687885, 15689940, 15675898, 15691924, 15677887, 15679913, 15676023, 15677523, 15679205, 15676911, 15676220, 15690293, 15682692, 15689180, 15683288, 15691547, 15687977, 15679522, 15680801, 15678056, 15681321, 15688362, 15676515, 15691136, 15686694, 15689803, 15675586, 15686735, 15682670, 15687896, 15675692, 15683132, 15678788, 15681031, 15676110, 15676691, 15680129, 15678401, 15678139, 15680841, 15684440, 15676335, 15681256, 15675660, 15675190, 15686348, 15679500, 15691565, 15677591, 15677871, 15678694, 15687093, 15679463, 15679303, 15678604, 15676711, 15677741, 15679320, 15674567, 15690473, 15679018, 15677066, 15679172, 15676544, 15679056, 15678068, 15683215, 15675856, 15684002, 15678078, 15679550, 15688524, 15678587, 15676492, 15678020, 15677465, 15683291, 15675327, 15682751, 15694976, 15675550, 15683969, 15692853, 15677626, 15677559, 15684552, 15683825, 15678598, 15682792, 15680716, 15676939, 15677095, 15678365, 15686220, 15676301, 15678880, 15681552, 15674956, 15680917, 15681465, 15675030, 15681020, 15674820, 15683709, 15674202, 15676429, 15677731, 15676689, 15679981, 15676933, 15679548, 15679724, 15674440, 15681412, 15674409, 15679083, 15675627, 15678516, 15695843, 15683538, 15678868, 15676452, 15675851, 15675600, 15679031, 15679222, 15683025, 15677855, 15687894, 15692916, 15684427, 15674251, 15687981, 15676723, 15675200, 15677896, 15677249, 15691358, 15686449 ]
*/
